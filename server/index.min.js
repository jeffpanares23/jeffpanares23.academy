const express=require("express"),cors=require("cors"),mysql=require("mysql"),bcrypt=require("bcrypt"),saltRounds=10,app=express();app.use(express.json()),app.use(cors());const connection=mysql.createConnection({user:"root",host:"localhost",password:"",database:"procademy"});connection.connect(err=>{err?console.error("Error connecting to MySQL database: ",err):console.log("Connected to MySQL database")}),app.get("/fetchUser",(req,res)=>{connection.query("SELECT * FROM user_tbl",(err,result)=>{err?(console.log(err),res.status(500).send("An error occurred")):res.send(result)})}),app.get("/user/:id",(req,res)=>{const{id:id}=req.params;connection.query(`SELECT * FROM user_tbl WHERE id = ${id}`,(err,result)=>{err?(console.log(err),res.status(500).send("An error occurred")):res.send(result)})}),app.post("/create",(req,res)=>{const{name:name,codename:codename,teamname:teamname,interest:interest,email:email,password:password,status:status,role:role}=req.body;bcrypt.hash(password,10,(err,hash)=>{err?(console.log(err),res.status(500).send("An error occurred")):connection.query("INSERT INTO user_tbl (name, codename, teamname, interest, email, password, status, role) VALUES (?, ?, ?, ?, ? ,? ,? ,?)",[name,codename,teamname,interest,email,hash,status,role],(err,result)=>{err?(console.log(err),res.status(500).send("An error occurred")):res.send("Values Inserted")})})}),app.post("/login",(req,res)=>{const username=req.body.username,password=req.body.password;connection.query("SELECT * FROM user_tbl WHERE username = ?;",username,(err,result)=>{err&&res.send({err:err}),result.length>0?bcrypt.compare(password,result[0].password,(error,response)=>{response?res.send(result):res.send({message:"Wrong username/password combination!"})}):res.send({message:"User doesn't exist"})})}),app.listen(8002,()=>{console.log("Server listening on port 8002")});